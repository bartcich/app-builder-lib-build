{"version":3,"sources":["../src/core.ts"],"names":[],"mappings":"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","sourcesContent":["import { Arch, archFromString, ArchType } from \"builder-util\"\r\nimport { Publish } from \"builder-util-runtime\"\r\n\r\nexport type TargetConfigType = Array<string | TargetConfiguration> | string | TargetConfiguration | null\r\n\r\nexport interface TargetConfiguration {\r\n  /**\r\n   * The target name. e.g. `snap`.\r\n   */\r\n  readonly target: string\r\n\r\n  /**\r\n   * The arch or list of archs.\r\n   */\r\n  readonly arch?: Array<ArchType> | ArchType\r\n}\r\n\r\nexport class Platform {\r\n  static MAC = new Platform(\"mac\", \"mac\", \"darwin\")\r\n  static LINUX = new Platform(\"linux\", \"linux\", \"linux\")\r\n  static WINDOWS = new Platform(\"windows\", \"win\", \"win32\")\r\n\r\n  constructor(public name: string, public buildConfigurationKey: string, public nodeName: NodeJS.Platform) {\r\n  }\r\n\r\n  toString() {\r\n    return this.name\r\n  }\r\n\r\n  createTarget(type?: string | Array<string> | null, ...archs: Array<Arch>): Map<Platform, Map<Arch, Array<string>>> {\r\n    if (type == null && (archs == null || archs.length === 0)) {\r\n      return new Map([[this, new Map()]])\r\n    }\r\n\r\n    const archToType = new Map()\r\n    if (this === Platform.MAC) {\r\n      archs = [Arch.x64]\r\n    }\r\n\r\n    for (const arch of (archs == null || archs.length === 0 ? [archFromString(process.arch)] : archs)) {\r\n      archToType.set(arch, type == null ? [] : (Array.isArray(type) ? type : [type]))\r\n    }\r\n    return new Map([[this, archToType]])\r\n  }\r\n\r\n  static current(): Platform {\r\n    return Platform.fromString(process.platform)\r\n  }\r\n\r\n  static fromString(name: string): Platform {\r\n    name = name.toLowerCase()\r\n    switch (name) {\r\n      case Platform.MAC.nodeName:\r\n      case Platform.MAC.name:\r\n        return Platform.MAC\r\n\r\n      case Platform.WINDOWS.nodeName:\r\n      case Platform.WINDOWS.name:\r\n      case Platform.WINDOWS.buildConfigurationKey:\r\n        return Platform.WINDOWS\r\n\r\n      case Platform.LINUX.nodeName:\r\n        return Platform.LINUX\r\n\r\n      default:\r\n        throw new Error(`Unknown platform: ${name}`)\r\n    }\r\n  }\r\n}\r\n\r\nexport abstract class Target {\r\n  abstract readonly outDir: string\r\n  abstract readonly options: TargetSpecificOptions | null | undefined\r\n\r\n  protected constructor(readonly name: string, readonly isAsyncSupported: boolean = true) {\r\n  }\r\n\r\n  async checkOptions(): Promise<any> {\r\n    // ignore\r\n  }\r\n\r\n  abstract build(appOutDir: string, arch: Arch): Promise<any>\r\n\r\n  finishBuild(): Promise<any> {\r\n    return Promise.resolve()\r\n  }\r\n}\r\n\r\nexport interface TargetSpecificOptions {\r\n  /**\r\n   The [artifact file name template](/configuration/configuration#artifact-file-name-template).\r\n   */\r\n  readonly artifactName?: string | null\r\n\r\n  publish?: Publish\r\n}\r\n\r\nexport const DEFAULT_TARGET = \"default\"\r\nexport const DIR_TARGET = \"dir\"\r\n\r\nexport type CompressionLevel = \"store\" | \"normal\" | \"maximum\"\r\n\r\nexport interface BeforeBuildContext {\r\n  readonly appDir: string\r\n  readonly electronVersion: string\r\n  readonly platform: Platform\r\n  readonly arch: string\r\n}\r\n\r\nexport interface SourceRepositoryInfo {\r\n  type?: string\r\n  domain?: string\r\n  user: string\r\n  project: string\r\n}"],"sourceRoot":""}
