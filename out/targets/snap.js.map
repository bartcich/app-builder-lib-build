{"version":3,"sources":["../../src/targets/snap.ts"],"names":[],"mappings":"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","sourcesContent":["import { Arch, executeAppBuilder, replaceDefault as _replaceDefault, serializeToYaml, toLinuxArchString } from \"builder-util\"\r\nimport { asArray } from \"builder-util-runtime\"\r\nimport { outputFile } from \"fs-extra-p\"\r\nimport * as path from \"path\"\r\nimport * as semver from \"semver\"\r\nimport { SnapOptions } from \"..\"\r\nimport { Target } from \"../core\"\r\nimport { LinuxPackager, toAppImageOrSnapArch } from \"../linuxPackager\"\r\nimport { PlugDescriptor } from \"../options/SnapOptions\"\r\nimport { LinuxTargetHelper } from \"./LinuxTargetHelper\"\r\nimport { createStageDirPath } from \"./targetUtil\"\r\n\r\n// libxss1, libasound2, gconf2 - was \"error while loading shared libraries: libXss.so.1\" on Xubuntu 16.04\r\n// noinspection SpellCheckingInspection\r\nconst defaultStagePackages = [\"libasound2\", \"libgconf2-4\", \"libnotify4\", \"libnspr4\", \"libnss3\", \"libpcre3\", \"libpulse0\", \"libxss1\", \"libxtst6\", \"libappindicator1\", \"libsecret-1-0\"]\r\nconst defaultPlugs = [\"desktop\", \"desktop-legacy\", \"home\", \"x11\", \"unity7\", \"browser-support\", \"network\", \"gsettings\", \"pulseaudio\", \"opengl\"]\r\n\r\nexport default class SnapTarget extends Target {\r\n  readonly options: SnapOptions = {...this.packager.platformSpecificBuildOptions, ...(this.packager.config as any)[this.name]}\r\n\r\n  public isUseTemplateApp = false\r\n\r\n  constructor(name: string, private readonly packager: LinuxPackager, private readonly helper: LinuxTargetHelper, readonly outDir: string) {\r\n    super(name)\r\n  }\r\n\r\n  private replaceDefault(inList: Array<string> | null | undefined, defaultList: Array<string>) {\r\n    const result = _replaceDefault(inList, defaultList)\r\n    if (result !== defaultList) {\r\n      this.isUseTemplateApp = false\r\n    }\r\n    return result\r\n  }\r\n\r\n  private get isElectron2(): boolean {\r\n    return semver.gte(this.packager.config.electronVersion || \"1.8.3\", \"2.0.0-beta.1\")\r\n  }\r\n\r\n  private createDescriptor(arch: Arch): any {\r\n    const appInfo = this.packager.appInfo\r\n    const snapName = this.packager.executableName.toLowerCase()\r\n    const options = this.options\r\n    const linuxArchName = toAppImageOrSnapArch(arch)\r\n\r\n    const plugs = normalizePlugConfiguration(options.plugs)\r\n    const plugNames = this.replaceDefault(plugs == null ? null : Object.getOwnPropertyNames(plugs), defaultPlugs)\r\n    const desktopPart = this.isElectron2 ? \"desktop-gtk3\" : \"desktop-gtk2\"\r\n\r\n    const buildPackages = asArray(options.buildPackages)\r\n    this.isUseTemplateApp = this.options.useTemplateApp !== false && arch === Arch.x64 && buildPackages.length === 0 && this.isElectron2\r\n\r\n    const appDescriptor: any = {\r\n      command: `command.sh`,\r\n      plugs: plugNames,\r\n    }\r\n    const snap: any = {\r\n      name: snapName,\r\n      version: appInfo.version,\r\n      summary: options.summary || appInfo.productName,\r\n      description: this.helper.getDescription(options),\r\n      confinement: options.confinement || \"strict\",\r\n      grade: options.grade || \"stable\",\r\n      architectures: [toLinuxArchString(arch)],\r\n      apps: {\r\n        [snapName]: appDescriptor\r\n      },\r\n      parts: {\r\n        app: {\r\n          plugin: \"nil\",\r\n          \"stage-packages\": this.replaceDefault(options.stagePackages, defaultStagePackages),\r\n          after: this.replaceDefault(options.after, [desktopPart]),\r\n        }\r\n      },\r\n    }\r\n\r\n    if (options.confinement !== \"classic\") {\r\n      appDescriptor.environment = {\r\n        TMPDIR: \"$XDG_RUNTIME_DIR\",\r\n        PATH: \"$SNAP/usr/sbin:$SNAP/usr/bin:$SNAP/sbin:$SNAP/bin:$PATH\",\r\n        LD_LIBRARY_PATH: [\r\n          \"$SNAP_LIBRARY_PATH\",\r\n          \"$SNAP/usr/lib/\" + linuxArchName + \"-linux-gnu:$SNAP/usr/lib/\" + linuxArchName + \"-linux-gnu/pulseaudio\",\r\n          \"$SNAP/usr/lib/\" + linuxArchName + \"-linux-gnu/mesa-egl\",\r\n          \"$SNAP/lib:$SNAP/usr/lib:$SNAP/lib/\" + linuxArchName + \"-linux-gnu:$SNAP/usr/lib/\" + linuxArchName + \"-linux-gnu\",\r\n          \"$LD_LIBRARY_PATH:$SNAP/lib:$SNAP/usr/lib\",\r\n          \"$SNAP/lib/\" + linuxArchName + \"-linux-gnu:$SNAP/usr/lib/\" + linuxArchName + \"-linux-gnu\"\r\n        ].join(\":\"),\r\n        ...options.environment,\r\n      }\r\n    }\r\n\r\n    if (!this.isUseTemplateApp) {\r\n      appDescriptor.adapter = \"none\"\r\n    }\r\n\r\n    if (buildPackages.length > 0) {\r\n      snap.parts.app[\"build-packages\"] = buildPackages\r\n    }\r\n\r\n    if (plugs != null) {\r\n      for (const plugName of plugNames) {\r\n        const plugOptions = plugs[plugName]\r\n        if (plugOptions == null) {\r\n          continue\r\n        }\r\n\r\n        if (snap.plugs == null) {\r\n          snap.plugs = {}\r\n        }\r\n        snap.plugs[plugName] = plugOptions\r\n      }\r\n    }\r\n\r\n    if (options.assumes != null) {\r\n      snap.assumes = asArray(options.assumes)\r\n    }\r\n\r\n    if (!this.isUseTemplateApp && snap.parts.app.after.includes(desktopPart)) {\r\n      // call super build (snapcraftctl build) otherwise /bin/desktop not created\r\n      // noinspection SpellCheckingInspection\r\n      const desktopPartOverride: any = {\r\n        \"override-build\": `set -x\r\nsnapcraftctl build\r\nexport XDG_DATA_DIRS=$SNAPCRAFT_PART_INSTALL/usr/share\r\nupdate-mime-database $SNAPCRAFT_PART_INSTALL/usr/share/mime\r\n\r\nfor dir in $SNAPCRAFT_PART_INSTALL/usr/share/icons/*/; do\r\n  if [ -f $dir/index.theme ]; then\r\n    if which gtk-update-icon-cache-3.0 &> /dev/null; then\r\n      gtk-update-icon-cache-3.0 -q $dir\r\n    elif which gtk-update-icon-cache &> /dev/null; then\r\n      gtk-update-icon-cache -q $dir\r\n    fi\r\n  fi\r\ndone`\r\n      }\r\n\r\n      if (appDescriptor.plugs.includes(\"desktop\") || appDescriptor.plugs.includes(\"desktop-legacy\")) {\r\n        desktopPartOverride.stage = [\"-./usr/share/fonts/**\"]\r\n      }\r\n\r\n      snap.parts[desktopPart] = desktopPartOverride\r\n    }\r\n\r\n    return snap\r\n  }\r\n\r\n  async build(appOutDir: string, arch: Arch): Promise<any> {\r\n    const packager = this.packager\r\n    const options = this.options\r\n    // tslint:disable-next-line:no-invalid-template-strings\r\n    const artifactName = packager.expandArtifactNamePattern(this.options, \"snap\", arch, \"${name}_${version}_${arch}.${ext}\", false)\r\n    const artifactPath = path.join(this.outDir, artifactName)\r\n    await packager.info.callArtifactBuildStarted({\r\n      targetPresentableName: \"snap\",\r\n      file: artifactPath,\r\n      arch,\r\n    })\r\n\r\n    const snap: any = this.createDescriptor(arch)\r\n    if (this.isUseTemplateApp) {\r\n      delete snap.parts\r\n    }\r\n\r\n    const stageDir = await createStageDirPath(this, packager, arch)\r\n    // snapcraft.yaml inside a snap directory\r\n    const snapMetaDir = path.join(stageDir, this.isUseTemplateApp ? \"meta\" : \"snap\")\r\n\r\n    const args = [\r\n      \"snap\",\r\n      \"--app\", appOutDir,\r\n      \"--stage\", stageDir,\r\n      \"--arch\", toLinuxArchString(arch),\r\n      \"--output\", artifactPath,\r\n      \"--executable\", this.packager.executableName,\r\n      \"--docker-image\", \"electronuserland/builder:latest\",\r\n    ]\r\n\r\n    await this.helper.icons\r\n    if (this.helper.maxIconPath != null) {\r\n      if (!this.isUseTemplateApp) {\r\n        snap.icon = \"snap/gui/icon.png\"\r\n      }\r\n      args.push(\"--icon\", this.helper.maxIconPath)\r\n    }\r\n\r\n    const desktopFile = path.join(snapMetaDir, \"gui\", `${snap.name}.desktop`)\r\n    await this.helper.writeDesktopEntry(this.options, packager.executableName, desktopFile, {\r\n      // tslint:disable:no-invalid-template-strings\r\n      Icon: \"${SNAP}/meta/gui/icon.png\"\r\n    })\r\n\r\n    if (packager.packagerOptions.effectiveOptionComputed != null && await packager.packagerOptions.effectiveOptionComputed({snap, desktopFile})) {\r\n      return\r\n    }\r\n\r\n    await outputFile(path.join(snapMetaDir, this.isUseTemplateApp ? \"snap.yaml\" : \"snapcraft.yaml\"), serializeToYaml(snap))\r\n\r\n    const hooksDir = await packager.getResource(options.hooks, \"snap-hooks\")\r\n    if (hooksDir != null) {\r\n      args.push(\"--hooks\", hooksDir)\r\n    }\r\n\r\n    if (this.isUseTemplateApp) {\r\n      args.push(\"--template-url\", \"electron2\")\r\n    }\r\n    await executeAppBuilder(args)\r\n    await packager.dispatchArtifactCreated(artifactPath, this, arch, packager.computeSafeArtifactName(artifactName, \"snap\", arch, false))\r\n  }\r\n}\r\n\r\nfunction normalizePlugConfiguration(raw: Array<string | PlugDescriptor> | PlugDescriptor | null | undefined): { [key: string]: PlugDescriptor | null } | null {\r\n  if (raw == null) {\r\n    return null\r\n  }\r\n\r\n  const result: any = {}\r\n  for (const item of (Array.isArray(raw) ? raw : [raw])) {\r\n    if (typeof item === \"string\") {\r\n      result[item] = null\r\n    }\r\n    else {\r\n      Object.assign(result, item)\r\n    }\r\n  }\r\n  return result\r\n}\r\n"],"sourceRoot":""}
