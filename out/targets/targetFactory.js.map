{"version":3,"sources":["../../src/targets/targetFactory.ts"],"names":[],"mappings":"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","sourcesContent":["import { addValue, Arch, archFromString, ArchType, asArray } from \"builder-util\"\r\nimport { PlatformSpecificBuildOptions, DEFAULT_TARGET, DIR_TARGET, Platform, Target, TargetConfiguration } from \"../index\"\r\nimport { PlatformPackager } from \"../platformPackager\"\r\nimport { ArchiveTarget } from \"./ArchiveTarget\"\r\n\r\nconst archiveTargets = new Set([\"zip\", \"7z\", \"tar.xz\", \"tar.lz\", \"tar.gz\", \"tar.bz2\"])\r\n\r\nexport function computeArchToTargetNamesMap(raw: Map<Arch, Array<string>>, options: PlatformSpecificBuildOptions, platform: Platform): Map<Arch, Array<string>> {\r\n  for (const targetNames of raw.values()) {\r\n    if (targetNames.length > 0) {\r\n      // https://github.com/electron-userland/electron-builder/issues/1355\r\n      return raw\r\n    }\r\n  }\r\n\r\n  const defaultArchs: Array<ArchType> = raw.size === 0 ? [platform === Platform.MAC ? \"x64\" : process.arch as ArchType] : Array.from(raw.keys()).map(it => Arch[it] as ArchType)\r\n  const result = new Map(raw)\r\n  for (const target of asArray(options.target).map<TargetConfiguration>(it => typeof it === \"string\" ? {target: it} : it)) {\r\n    let name = target.target\r\n    let archs = target.arch\r\n    const suffixPos = name.lastIndexOf(\":\")\r\n    if (suffixPos > 0) {\r\n      name = target.target.substring(0, suffixPos)\r\n      if (archs == null) {\r\n        archs = target.target.substring(suffixPos + 1) as ArchType\r\n      }\r\n    }\r\n\r\n    for (const arch of archs == null ? defaultArchs : asArray(archs)) {\r\n      addValue(result, archFromString(arch), name)\r\n    }\r\n  }\r\n\r\n  if (result.size === 0) {\r\n    for (const arch of defaultArchs) {\r\n      result.set(archFromString(arch), [])\r\n    }\r\n  }\r\n\r\n  return result\r\n}\r\n\r\nexport function createTargets(nameToTarget: Map<string, Target>, rawList: Array<string>, outDir: string, packager: PlatformPackager<any>): Array<Target> {\r\n  const result: Array<Target> = []\r\n\r\n  const mapper = (name: string, factory: (outDir: string) => Target) => {\r\n    let target = nameToTarget.get(name)\r\n    if (target == null) {\r\n      target = factory(outDir)\r\n      nameToTarget.set(name, target)\r\n    }\r\n    result.push(target)\r\n  }\r\n\r\n  const targets = normalizeTargets(rawList, packager.defaultTarget)\r\n  packager.createTargets(targets, mapper)\r\n  return result\r\n}\r\n\r\nfunction normalizeTargets(targets: Array<string>, defaultTarget: Array<string>): Array<string> {\r\n  const list: Array<string> = []\r\n  for (const t of targets) {\r\n    const name = t.toLowerCase().trim()\r\n    if (name === DEFAULT_TARGET) {\r\n      list.push(...defaultTarget)\r\n    }\r\n    else {\r\n      list.push(name)\r\n    }\r\n  }\r\n  return list\r\n}\r\n\r\nexport function createCommonTarget(target: string, outDir: string, packager: PlatformPackager<any>): Target {\r\n  if (archiveTargets.has(target)) {\r\n    return new ArchiveTarget(target, outDir, packager)\r\n  }\r\n  else if (target === DIR_TARGET) {\r\n    return new NoOpTarget(DIR_TARGET)\r\n  }\r\n  else {\r\n    throw new Error(`Unknown target: ${target}`)\r\n  }\r\n}\r\n\r\nexport class NoOpTarget extends Target {\r\n  readonly options = null\r\n\r\n  constructor(name: string) {\r\n    super(name)\r\n  }\r\n\r\n  get outDir(): string {\r\n    throw new Error(\"NoOpTarget\")\r\n  }\r\n\r\n  async build(appOutDir: string, arch: Arch): Promise<any> {\r\n    // no build\r\n  }\r\n}"],"sourceRoot":""}
