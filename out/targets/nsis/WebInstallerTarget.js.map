{"version":3,"sources":["../../../src/targets/nsis/WebInstallerTarget.ts"],"names":[],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAGA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAGA;AACM,MAAO,kBAAP,SAAkC,wBAAlC,CAA4C;AAChD,EAAA,WAAA,CAAY,QAAZ,EAAmC,MAAnC,EAAmD,UAAnD,EAAuE,aAAvE,EAAsG;AACpG,UAAM,QAAN,EAAgB,MAAhB,EAAwB,UAAxB,EAAoC,aAApC;AACD;;AAED,MAAI,cAAJ,GAAkB;AAChB,WAAO,IAAP;AACD;;AAES,QAAM,gBAAN,CAAuB,QAAvB,EAA0C,OAA1C,EAAsD;AAC9D;AACA,UAAO,yBAAW,SAAX,CAA4C,gBAA5C,CAA6D,IAA7D,CAAkE,IAAlE,EAAwE,QAAxE,EAAkF,OAAlF,CAAP;AAEA,UAAM,QAAQ,GAAG,KAAK,QAAtB;AACA,UAAM,OAAO,GAAG,KAAK,OAArB;AAEA,QAAI,aAAa,GAAG,OAAO,CAAC,aAA5B;;AACA,QAAI,aAAa,IAAI,IAArB,EAA2B;AACzB,YAAM,cAAc,GAAG,MAAM,sDAA+B,QAA/B,GAAyC,MAAM,yCAAkB,QAAlB,EAA4B,QAAQ,CAAC,IAAT,CAAc,MAA1C,EAAkD,IAAlD,EAAwD,KAAxD,CAA/C,GAA+G,IAA/G,CAA7B;;AACA,UAAI,cAAc,IAAI,IAAlB,IAA0B,cAAc,CAAC,MAAf,KAA0B,CAAxD,EAA2D;AACzD,cAAM,IAAI,KAAJ,CAAU,yCAAV,CAAN;AACD;;AAED,MAAA,aAAa,GAAG,0CAAmB,cAAc,CAAC,CAAD,CAAjC,EAAsC,IAAtC,EAA4C,QAA5C,CAAhB;AAEA,MAAA,OAAO,CAAC,4BAAR,GAAuC,IAAvC;AACD;;AAED,IAAA,OAAO,CAAC,eAAR,GAA0B,aAA1B;AACD;;AAED,MAAc,wBAAd,GAAsC;AACpC;AACA,WAAO,4CAAP;AACD;;AAES,EAAA,2BAA2B,GAAA;AACnC,UAAM,OAAO,GAAG,KAAK,QAAL,CAAc,OAA9B;AACA,UAAM,UAAU,GAAG,OAAO,CAAC,IAAR,CAAa,WAAb,OAA+B,OAAO,CAAC,IAAvC,GAA8C,WAA9C,GAA4D,UAA/E;AACA,WAAO,GAAG,OAAO,CAAC,IAAI,IAAI,UAAU,IAAI,OAAO,CAAC,OAAO,MAAvD;AACD;;AAxC+C,C","sourcesContent":["import { computeDownloadUrl, getPublishConfigs, getPublishConfigsForUpdateInfo } from \"../../publish/PublishManager\"\r\nimport { WinPackager } from \"../../winPackager\"\r\nimport { NsisWebOptions } from \"./nsisOptions\"\r\nimport { NsisTarget } from \"./NsisTarget\"\r\nimport { AppPackageHelper } from \"./nsisUtil\"\r\n\r\n/** @private */\r\nexport class WebInstallerTarget extends NsisTarget {\r\n  constructor(packager: WinPackager, outDir: string, targetName: string, packageHelper: AppPackageHelper) {\r\n    super(packager, outDir, targetName, packageHelper)\r\n  }\r\n\r\n  get isWebInstaller(): boolean {\r\n    return true\r\n  }\r\n\r\n  protected async configureDefines(oneClick: boolean, defines: any): Promise<any> {\r\n    //noinspection ES6MissingAwait\r\n    await (NsisTarget.prototype as WebInstallerTarget).configureDefines.call(this, oneClick, defines)\r\n\r\n    const packager = this.packager\r\n    const options = this.options as NsisWebOptions\r\n\r\n    let appPackageUrl = options.appPackageUrl\r\n    if (appPackageUrl == null) {\r\n      const publishConfigs = await getPublishConfigsForUpdateInfo(packager, await getPublishConfigs(packager, packager.info.config, null, false), null)\r\n      if (publishConfigs == null || publishConfigs.length === 0) {\r\n        throw new Error(\"Cannot compute app package download URL\")\r\n      }\r\n\r\n      appPackageUrl = computeDownloadUrl(publishConfigs[0], null, packager)\r\n\r\n      defines.APP_PACKAGE_URL_IS_INCOMLETE = null\r\n    }\r\n\r\n    defines.APP_PACKAGE_URL = appPackageUrl\r\n  }\r\n\r\n  protected get installerFilenamePattern(): string {\r\n    // tslint:disable:no-invalid-template-strings\r\n    return \"${productName} Web Setup ${version}.${ext}\"\r\n  }\r\n\r\n  protected generateGitHubInstallerName(): string {\r\n    const appInfo = this.packager.appInfo\r\n    const classifier = appInfo.name.toLowerCase() === appInfo.name ? \"web-setup\" : \"WebSetup\"\r\n    return `${appInfo.name}-${classifier}-${appInfo.version}.exe`\r\n  }\r\n}"],"sourceRoot":""}
