{"version":3,"sources":["../../../src/targets/nsis/nsisScriptGenerator.ts"],"names":[],"mappings":";;;;;;;AAAM,MAAO,mBAAP,CAA0B;AAAhC,EAAA,WAAA,GAAA;AACmB,SAAA,KAAA,GAAuB,EAAvB;AA+ClB;;AA7CC,EAAA,aAAa,CAAC,IAAD,EAAa;AACxB,SAAK,KAAL,CAAW,IAAX,CAAgB,mBAAmB,IAAI,GAAvC;AACD;;AAED,EAAA,YAAY,CAAC,UAAD,EAAqB,GAArB,EAAgC;AAC1C,SAAK,KAAL,CAAW,IAAX,CAAgB,kBAAkB,UAAU,KAAK,GAAG,GAApD;AACD;;AAED,EAAA,OAAO,CAAC,IAAD,EAAa;AAClB,SAAK,KAAL,CAAW,IAAX,CAAgB,aAAa,IAAI,GAAjC;AACD;;AAED,EAAA,KAAK,CAAC,IAAD,EAAe,KAAf,EAAyD;AAC5D,SAAK,KAAL,CAAW,IAAX,CACE,UAAU,IAAI,EADhB,EAEE,KAAK,CAAC,KAAK,CAAC,OAAN,CAAc,KAAd,IAAuB,KAAvB,GAAgC,KAA6B,CAAC,KAA/D,EAAsE,IAAtE,CAA2E,MAA3E,CAAkF,EAFzF,EAGE,aAHF;AAKD;;AAED,EAAA,IAAI,CAAC,UAAD,EAA4B,IAA5B,EAAwC;AAC1C,SAAK,KAAL,CAAW,IAAX,CAAgB,OAAO,UAAU,IAAI,IAAd,GAAqB,EAArB,GAA0B,YAAY,UAAU,GAAG,KAAK,IAAI,GAAnF;AACD;;AAED,EAAA,WAAW,CAAC,IAAD,EAAe,UAAf,EAAiC;AAC1C,SAAK,KAAL,CAAW,IAAX,CAAgB,gBAAgB,IAAI,IAAI,UAAU,EAAlD;AACD,GA7B6B,CA+B9B;;;AACA,EAAA,KAAK,CAAC,KAAD,EAAqB;AACxB,SAAK,MAAM,QAAX,IAAuB,KAAvB,EAA8B;AAC5B,YAAM,YAAY,GAAG,iBAAiB,CAAC,QAAD,CAAjB,CAClB,OADkB,CACV,cADU,EACM,CAAC,CAAD,EAAI,EAAJ,KAAW,EAAE,CAAC,WAAH,EADjB,CAArB;AAEA,WAAK,KAAL,CAAW,IAAX,CAAgB,WAAW,YAAY;oCACT,QAAQ;;;UAGlC,YAAY,SAAS,YAAY;CAJrC;AAMD;AACF;;AAED,EAAA,KAAK,GAAA;AACH,WAAO,KAAK,KAAL,CAAW,IAAX,CAAgB,IAAhB,IAAwB,IAA/B;AACD;;AA/C6B;;;;AAkDhC,SAAS,iBAAT,CAA2B,QAA3B,EAA2C;AACzC,MAAI,QAAQ,KAAK,UAAjB,EAA6B;AAC3B,WAAO,eAAP;AACD;;AACD,MAAI,QAAQ,KAAK,aAAjB,EAAgC;AAC9B,WAAO,kBAAP;AACD;;AACD,SAAO,OAAO,QAAQ,CAAC,CAAD,CAAR,CAAY,WAAZ,EAAP,GAAmC,QAAQ,CAAC,SAAT,CAAmB,CAAnB,CAA1C;AACD,C","sourcesContent":["export class NsisScriptGenerator {\r\n  private readonly lines: Array<string> = []\r\n\r\n  addIncludeDir(file: string) {\r\n    this.lines.push(`!addincludedir \"${file}\"`)\r\n  }\r\n\r\n  addPluginDir(pluginArch: string, dir: string) {\r\n    this.lines.push(`!addplugindir /${pluginArch} \"${dir}\"`)\r\n  }\r\n\r\n  include(file: string) {\r\n    this.lines.push(`!include \"${file}\"`)\r\n  }\r\n\r\n  macro(name: string, lines: Array<string> | NsisScriptGenerator) {\r\n    this.lines.push(\r\n      `!macro ${name}`,\r\n      `  ${(Array.isArray(lines) ? lines : (lines as NsisScriptGenerator).lines).join(\"\\n  \")}`,\r\n      `!macroend\\n`\r\n    )\r\n  }\r\n\r\n  file(outputName: string | null, file: string) {\r\n    this.lines.push(`File${outputName == null ? \"\" : ` \"/oname=${outputName}\"`} \"${file}\"`)\r\n  }\r\n\r\n  insertMacro(name: string, parameters: string) {\r\n    this.lines.push(`!insertmacro ${name} ${parameters}`)\r\n  }\r\n\r\n  // without -- !!!\r\n  flags(flags: Array<string>) {\r\n    for (const flagName of flags) {\r\n      const variableName = getVarNameForFlag(flagName)\r\n        .replace(/[\\-]+(\\w|$)/g, (m, p1) => p1.toUpperCase())\r\n      this.lines.push(`!macro _${variableName} _a _b _t _f\r\n  $\\{StdUtils.TestParameter} $R9 \"${flagName}\"\r\n  StrCmp \"$R9\" \"true\" \\`$\\{_t}\\` \\`$\\{_f}\\`\r\n!macroend\r\n!define ${variableName} \\`\"\" ${variableName} \"\"\\`\r\n`)\r\n    }\r\n  }\r\n\r\n  build() {\r\n    return this.lines.join(\"\\n\") + \"\\n\"\r\n  }\r\n}\r\n\r\nfunction getVarNameForFlag(flagName: string): string {\r\n  if (flagName === \"allusers\") {\r\n    return \"isForAllUsers\"\r\n  }\r\n  if (flagName === \"currentuser\") {\r\n    return \"isForCurrentUser\"\r\n  }\r\n  return \"is\" + flagName[0].toUpperCase() + flagName.substring(1)\r\n}"],"sourceRoot":""}
