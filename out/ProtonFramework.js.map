{"version":3,"sources":["../src/ProtonFramework.ts"],"names":[],"mappings":"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","sourcesContent":["import { FileTransformer } from \"builder-util/out/fs\"\r\nimport { log } from \"builder-util\"\r\nimport { safeStringifyJson } from \"builder-util-runtime\"\r\nimport { Platform } from \"./core\"\r\nimport { NODE_MODULES_PATTERN } from \"./fileTransformer\"\r\nimport { LibUiFramework } from \"./frameworks/LibUiFramework\"\r\nimport { getTemplatePath } from \"./util/pathManager\"\r\n\r\nexport class ProtonFramework extends LibUiFramework {\r\n  readonly name = \"proton\"\r\n\r\n  // noinspection JSUnusedGlobalSymbols\r\n  readonly defaultAppIdPrefix = \"com.proton-native.\"\r\n\r\n  constructor(version: string, distMacOsAppName: string, isUseLaunchUi: boolean) {\r\n    super(version, distMacOsAppName, isUseLaunchUi)\r\n  }\r\n\r\n  getDefaultIcon(platform: Platform) {\r\n    if (platform === Platform.WINDOWS) {\r\n      return getTemplatePath(\"icons/proton-native/proton-native.ico\")\r\n    }\r\n    else if (platform === Platform.LINUX) {\r\n      return getTemplatePath(\"icons/proton-native/linux\")\r\n    }\r\n    else {\r\n      return getTemplatePath(\"icons/proton-native/proton-native.icns\")\r\n    }\r\n  }\r\n\r\n  createTransformer(): FileTransformer | null {\r\n    let babel: any\r\n    const babelOptions: any = {ast: false, sourceMaps: \"inline\"}\r\n    if (process.env.TEST_SET_BABEL_PRESET === \"true\") {\r\n      babel = require(\"@babel/core\")\r\n      babel = testOnlyBabel(babel, babelOptions, this.version)\r\n    }\r\n    else {\r\n      try {\r\n        babel = require(\"babel-core\")\r\n      }\r\n      catch (e) {\r\n        // babel isn't installed\r\n        log.debug(null, \"don't transpile source code using Babel\")\r\n        return null\r\n      }\r\n    }\r\n\r\n    log.info({options: safeStringifyJson(babelOptions, new Set<string>([\"presets\"]))}, \"transpile source code using Babel\")\r\n    return file => {\r\n      if (!(file.endsWith(\".js\") || file.endsWith(\".jsx\")) || file.includes(NODE_MODULES_PATTERN)) {\r\n        return null\r\n      }\r\n\r\n      return new Promise((resolve, reject) => {\r\n        return babel.transformFile(file, babelOptions, (error: Error, result: any) => {\r\n          if (error == null) {\r\n            resolve(result.code)\r\n          }\r\n          else {\r\n            reject(error)\r\n          }\r\n        })\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nfunction testOnlyBabel(babel: any, babelOptions: any, nodeVersion: string) {\r\n  // out test dir can be located outside of electron-builder node_modules and babel cannot resolve string names of preset\r\n  babelOptions.presets = [\r\n    [require(\"@babel/preset-env\").default, {targets: {node: nodeVersion}}],\r\n    require(\"@babel/preset-react\"),\r\n  ]\r\n  babelOptions.plugins = [\r\n    // stage 0\r\n    require(\"@babel/plugin-proposal-function-bind\").default,\r\n\r\n    // stage 1\r\n    require(\"@babel/plugin-proposal-export-default-from\").default,\r\n    require(\"@babel/plugin-proposal-logical-assignment-operators\").default,\r\n    [require(\"@babel/plugin-proposal-optional-chaining\").default, {loose: false}],\r\n    [require(\"@babel/plugin-proposal-pipeline-operator\").default, {proposal: \"minimal\"}],\r\n    [require(\"@babel/plugin-proposal-nullish-coalescing-operator\").default, {loose: false}],\r\n    require(\"@babel/plugin-proposal-do-expressions\").default,\r\n\r\n    // stage 2\r\n    [require(\"@babel/plugin-proposal-decorators\").default, {legacy: true}],\r\n    require(\"@babel/plugin-proposal-function-sent\").default,\r\n    require(\"@babel/plugin-proposal-export-namespace-from\").default,\r\n    require(\"@babel/plugin-proposal-numeric-separator\").default,\r\n    require(\"@babel/plugin-proposal-throw-expressions\").default,\r\n\r\n    // stage 3\r\n    require(\"@babel/plugin-syntax-dynamic-import\").default,\r\n    require(\"@babel/plugin-syntax-import-meta\").default,\r\n    [require(\"@babel/plugin-proposal-class-properties\").default, {loose: false}],\r\n    require(\"@babel/plugin-proposal-json-strings\").default,\r\n  ]\r\n  babelOptions.babelrc = false\r\n  return babel\r\n}"],"sourceRoot":""}
